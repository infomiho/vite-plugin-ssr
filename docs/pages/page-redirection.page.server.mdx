import { Link } from '@brillout/docpress'

Page moved to
 - 

URL redirections (aka "page redirections") are commonly used to protect private pages by redirecting unauthenticated users (e.g. from `/admin` to `/login`).

We can both URL redirection as well as URL rewriting:
 - render('/login')
 - rewrite('/login')

 the URL

> Vite-plugin-ssr doesn't have a built-in redirect mechanism, but
> it provides enough control: we can implement URL redirections ourselves.

URL redirections (aka "page redirections") are commonly used to protect private pages by redirecting unauthenticated users (e.g. from `/admin` to `/login`).
With vite-plugin-ssr, we can use a Route Function instead of doing such URL redirection, see <Link href="#authentication" />.

For other use cases, we can implement redirections on
the server-side (see <Link href="#server-side" />) as well as on
the client-side (see <Link href="#client-side" />).

A frequent problem with client-side redirections are hydration mismatches, see <Link href="#hydration-mismatch" />.



```js
// movie.page.server.js

export { onBeforeRender }

async function onBeforeRender(pageContext) {
  const movie = await fetchMovie(pageContext.routeParams.movieId)
  // If the user goes to `/movie/42` but there is no movie with ID `42` then
  // we redirect the user to `/movie/add` so he can add a new movie.
  if (movie === null) {
    return {
      pageContext: {
        redirectTo: '/movie/add'
      }
    }
  }
}
```
```js
// /renderer/_default.page.server.js
// Environment: server

export { render }

function render(pageContext) {
  const { redirectTo } = pageContext
  if (redirectTo) {
    return {
      pageContext: {
        redirectTo
      }
    }
  }

  // The usual stuff
  // ...
}
```

> Note that vite-plugin-ssr doesn't know anything about `pageContext.redirectTo`: it's a <Link text={<>custom <code>pageContext</code> value</>} href="/pageContext#custom" />.


## Client-side

If we use <Link href="/client-routing" noBreadcrumb={true} />, then we can also redirect on the client-side.

```js
// /renderer/_default.page.server.js
// Environment: server

// We make `pageContext.redirectTo` available to the browser for client-side redirection
export const passToClient = [/*...*/, 'redirectTo']
```
```js
// /renderer/_default.page.client.js
// Environment: browser

import { navigate } from 'vite-plugin-ssr/client/router'

export function render(pageContext) {
  const { redirectTo } = pageContext
  if (redirectTo) {
    navigate(redirectTo)
    return
  }

  // The usual stuff
  // ...
}
```

> Note that vite-plugin-ssr doesn't know anything about `pageContext.redirectTo`: it's a <Link text={<>custom <code>pageContext</code> value</>} href="/pageContext#custom" />.


## Hydration Mismatch

If we use Client Routing we may end up with a [hydration mismatch](/hydration-mismatch).

To remove the hydration mismatch, we may need to redirect on both the client-side and server-side.

There are situations when server-side redirection isn't an option and we can only redirect on the client-side. In such case we can [suppress the hydration mismatch warning](/hydration-mismatch#suppress-hydration-mismatch). Alternatively, we can also first hydrate the original page (before redirecting) and then redirect and render the new page.
